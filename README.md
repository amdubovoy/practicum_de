# Тестовое задание (Яндекс.Практикум)

- [Тестовое задание (Яндекс.Практикум)](#тестовое-задание-яндекспрактикум)
  - [Как запускать](#как-запускать)
  - [Как работать](#как-работать)
    - [Команды](#команды)
    - [Как проверять](#как-проверять)
  - [Как завершать работу](#как-завершать-работу)

## Как запускать

1. Убедитесь, что на вашем компьютере установлен Docker.
1. Склонируйте репозиторий.
1. Запустите терминал и перейдите в директорию с репозиторием.
1. Убедитесь, что Docker запущен.
1. Выполните команду `make start`.

## Как работать

### Команды

После запуска контейнера нужно подождать какое-то время (как правило, не более 1-3 минут) для запуска всех сервисов. Если какой-то из веб-интерфейсов не открывается, попробуйте позже.

* `make logs` выведет последние 150 строк лога docker compose.
* `make pgadmin` откроет в браузере админку pgadmin.
  * email: admin@admin.com
  * password: admin

* `make airflow` откроет в браузере веб-интерфейс Airflow.
  * login: admin
  * password: admin

* `make exec` запустит терминал внутри контейнера с Airflow.

### Как проверять

Для начала необходимо запустить DAG. Чтобы это сделать, перейдите в веб-интерфейс Airflow (`make airflow`) и переключите флажок активности у пайплайна `exchangerate`.

В pgadmin уже добавлено необходимое соединение. Нас интересует база `data`.

Выполните запрос `select * from data.exchangerate limit 50;`, используя базу данных `data`, чтобы убедиться, что исторические данные «доехали».

Чтобы проверить работу пайплайна после прогрузки исторических данных без ожидания в 3 часа, вы можете зайти в контейнер (`make exec`) и выполнить вручную команду `airflow tasks test exchangerate get_exchangerate_data <сегодняшняя_дата>`, где `<сегодняшняя_дата>` — это дата в формате YYYY-MM-DD.

## Как завершать работу

Выполните команду `make stop`. Окружение будет остановлено, а контейнеры, volumes и images будут удалены.

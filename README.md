# Тестовое задание (Яндекс.Практикум)

- [Тестовое задание (Яндекс.Практикум)](#тестовое-задание-яндекспрактикум)
  - [Как запускать](#как-запускать)
  - [Как работать](#как-работать)
    - [Команды](#команды)
    - [Как проверять](#как-проверять)
  - [Как завершать работу](#как-завершать-работу)

## Как запускать

1. Убедитесь, что на вашем компьютере установлен Docker Desktop.

    Для работы с репозиторием в Windows, вероятно, потребуется совершить какие-то дополнительные шаги. Подробнее: [Docker Desktop WSL 2 backend](https://docs.docker.com/desktop/windows/wsl/)

2. Склонируйте репозиторий.
3. Запустите терминал и перейдите в директорию с репозиторием.
4. Убедитесь, что Docker запущен.
5. Выполните команду `make start`.

## Как работать

### Команды

После выполнения команды нужно подождать какое-то время (как правило, не более 1-3 минут) для запуска всех сервисов. Если какой-то из веб-интерфейсов не открывается, просто подождите.

* `make logs` выведет последние 150 строк лога docker compose.
* `make pgadmin` откроет в браузере админку pgadmin.
  * email: admin@admin.com
  * password: admin

* `make airflow` откроет в браузере веб-интерфейс Airflow.
  * login: admin
  * password: admin

* `make exec` запустит терминал внутри контейнера с Airflow.

    Выйти из него можно командой `exit`.

### Как проверять

В pgadmin уже добавлено необходимое соединение. Нас интересует БД `data`. Удостоверимся, что в таблице нет данных: `select * from data.exchangerate limit 50;`

Теперь необходимо запустить DAG. Чтобы это сделать, перейдите в веб-интерфейс Airflow (`make airflow`) и переключите флажок активности у пайплайна `exchangerate`.

Выполним запрос в pgadmin ещё раз, чтобы убедиться, что исторические данные «доехали».

Чтобы проверить работу пайплайна после прогрузки исторических данных без ожидания в 3 часа, вы можете зайти в контейнер (`make exec`) и выполнить вручную команду `airflow tasks test exchangerate get_exchangerate_data <сегодняшняя_дата>`, где `<сегодняшняя_дата>` — это дата в формате `YYYY-MM-DD`. Кроме того, вы можете запустить DAG из веб-интерфейса нажатием кнопки ▶️.

## Как завершать работу

Выполните команду `make stop`. Окружение будет остановлено, а контейнеры, volumes и images будут удалены.
